(function(){window.AudioContext=window.AudioContext||window.webkitAudioContext;var n_slides=d3.selectAll("section")[0].length,_sound={},source,context=new AudioContext,bufferList=[],urlList=[];function loadBuffer(url,slide_number){var request=new XMLHttpRequest;request.open("GET",url,true);request.responseType="arraybuffer";request.onload=function(){context.decodeAudioData(request.response,function(buffer){if(!buffer){alert("error decoding file data: "+url);return}bufferList[slide_number]=buffer;console.log("Loaded sound for slide num: "+slide_number)},function(error){console.log("No sound for slide num: "+slide_number)})};request.onerror=function(){alert("BufferLoader: XHR error")};request.send()}function stop(){if(source)source.stop(0)}function play(n){stop();if(bufferList[n]){source=context.createBufferSource();source.buffer=bufferList[n];source.connect(context.destination);source.start(0)}else{console.log("Can't play, slide "+n+" has no sound.")}}for(var i=0;i<=n_slides;++i){urlList[i]="sounds/"+i+".mp3";loadBuffer(urlList[i],i)}d3.select(window).on("keydown.sound",function(){if(d3.event.keyCode===83)play(stack.position())});return _sound})();